<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ğŸ“š ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆæ¤œç´¢ã‚·ã‚¹ãƒ†ãƒ  - ãƒ­ã‚°ã‚¤ãƒ³</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      min-height: 100vh;
      display: flex;
      align-items: center;
      justify-content: center;
      color: #333;
    }
    
    .login-container {
      background: white;
      border-radius: 16px;
      box-shadow: 0 15px 35px rgba(0, 0, 0, 0.1);
      overflow: hidden;
      width: 100%;
      max-width: 400px;
      animation: slideUp 0.6s ease-out;
    }
    
    @keyframes slideUp {
      from {
        opacity: 0;
        transform: translateY(30px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }
    
    .login-header {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      padding: 32px 24px;
      text-align: center;
      color: white;
    }
    
    .login-header h1 {
      font-size: 24px;
      font-weight: 600;
      margin-bottom: 8px;
    }
    
    .login-header p {
      opacity: 0.9;
      font-size: 14px;
    }
    
    .login-form {
      padding: 32px 24px;
    }
    
    .form-group {
      margin-bottom: 24px;
    }
    
    .form-group label {
      display: block;
      margin-bottom: 8px;
      font-weight: 500;
      color: #555;
    }
    
    .form-group input {
      width: 100%;
      padding: 12px 16px;
      border: 2px solid #e1e5e9;
      border-radius: 8px;
      font-size: 16px;
      transition: all 0.3s ease;
      background: #f8f9fa;
    }
    
    .form-group input:focus {
      outline: none;
      border-color: #667eea;
      background: white;
      box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
    }
    
    .login-button {
      width: 100%;
      padding: 12px;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      border: none;
      border-radius: 8px;
      font-size: 16px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s ease;
      position: relative;
      overflow: hidden;
    }
    
    .login-button:hover {
      transform: translateY(-2px);
      box-shadow: 0 8px 25px rgba(102, 126, 234, 0.3);
    }
    
    .login-button:active {
      transform: translateY(0);
    }
    
    .login-button:disabled {
      background: #ccc;
      cursor: not-allowed;
      transform: none;
      box-shadow: none;
    }
    
    .login-button .loading {
      display: none;
    }
    
    .login-button.loading .loading {
      display: inline-block;
      animation: spin 1s linear infinite;
    }
    
    .login-button.loading .text {
      display: none;
    }
    
    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }
    
    .status-message {
      margin-top: 16px;
      padding: 12px 16px;
      border-radius: 8px;
      font-size: 14px;
      display: none;
      animation: fadeIn 0.3s ease;
    }
    
    .status-message.success {
      background: #d4edda;
      color: #155724;
      border: 1px solid #c3e6cb;
    }
    
    .status-message.error {
      background: #f8d7da;
      color: #721c24;
      border: 1px solid #f5c6cb;
    }
    
    .status-message.info {
      background: #d1ecf1;
      color: #0c5460;
      border: 1px solid #bee5eb;
    }
    
    @keyframes fadeIn {
      from { opacity: 0; }
      to { opacity: 1; }
    }
    
    .demo-accounts {
      margin-top: 24px;
      padding: 16px;
      background: #f8f9fa;
      border-radius: 8px;
      border: 1px solid #e9ecef;
    }
    
    .demo-accounts h4 {
      color: #495057;
      margin-bottom: 12px;
      font-size: 14px;
    }
    
    .demo-account {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 8px 0;
      border-bottom: 1px solid #e9ecef;
      cursor: pointer;
      transition: background 0.2s ease;
    }
    
    .demo-account:last-child {
      border-bottom: none;
    }
    
    .demo-account:hover {
      background: #e9ecef;
      border-radius: 4px;
    }
    
    .demo-account .account-info {
      font-size: 13px;
      color: #6c757d;
    }
    
    .demo-account .account-role {
      font-size: 12px;
      padding: 2px 8px;
      border-radius: 12px;
      color: white;
    }
    
    .demo-account .admin {
      background: #dc3545;
    }
    
    .demo-account .user {
      background: #28a745;
    }
    
    .footer {
      text-align: center;
      padding: 16px;
      color: #6c757d;
      font-size: 12px;
      border-top: 1px solid #e9ecef;
    }
    
    /* ãƒ¬ã‚¹ãƒãƒ³ã‚·ãƒ–å¯¾å¿œ */
    @media (max-width: 480px) {
      .login-container {
        margin: 16px;
        max-width: none;
      }
      
      .login-header {
        padding: 24px 16px;
      }
      
      .login-form {
        padding: 24px 16px;
      }
    }
  </style>
</head>
<body>
  <div class="login-container">
    <div class="login-header">
      <h1>ğŸ“š ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆæ¤œç´¢ã‚·ã‚¹ãƒ†ãƒ </h1>
      <p>ãƒ­ã‚°ã‚¤ãƒ³ã—ã¦æ¤œç´¢ã‚’é–‹å§‹</p>
    </div>
    
    <div class="login-form">
      <form id="loginForm" onsubmit="return false;">
        <div class="form-group">
          <label for="email">ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹</label>
          <input 
            type="email" 
            id="email" 
            name="email" 
            placeholder="ä¾‹: admin@example.com"
            required
            autocomplete="email"
          >
        </div>
        
        <div class="form-group">
          <label for="password">ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰</label>
          <input 
            type="password" 
            id="password" 
            name="password" 
            placeholder="ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’å…¥åŠ›"
            required
            autocomplete="current-password"
          >
        </div>
        
        <button type="submit" class="login-button" id="loginButton" onclick="performLogin()">
          <span class="loading">âŸ³</span>
          <span class="text">ãƒ­ã‚°ã‚¤ãƒ³</span>
        </button>
        
        <div id="statusMessage" class="status-message"></div>
      </form>
      
      <div class="demo-accounts">
        <h4>ğŸ”‘ ãƒ‡ãƒ¢ã‚¢ã‚«ã‚¦ãƒ³ãƒˆï¼ˆã‚¯ãƒªãƒƒã‚¯ã§è‡ªå‹•å…¥åŠ›ï¼‰</h4>
        <div class="demo-account" onclick="fillDemoAccount('admin@example.com', 'Admin_2025!')">
          <div class="account-info">admin@example.com / Admin_2025!</div>
          <div class="account-role admin">ç®¡ç†è€…</div>
        </div>
        <div class="demo-account" onclick="fillDemoAccount('user@example.com', 'user123')">
          <div class="account-info">user@example.com / user123</div>
          <div class="account-role user">ä¸€èˆ¬ãƒ¦ãƒ¼ã‚¶ãƒ¼</div>
        </div>
      </div>
    </div>
    
    <div class="footer">
      ğŸ¤– Powered by Google Apps Script | å®‰å…¨ãªãƒ­ã‚°ã‚¤ãƒ³ã‚·ã‚¹ãƒ†ãƒ 
    </div>
  </div>

  <script>
    // ãƒšãƒ¼ã‚¸èª­ã¿è¾¼ã¿æ™‚ã®åˆæœŸåŒ–
    window.onload = function() {
      console.log('ğŸš€ ãƒ­ã‚°ã‚¤ãƒ³ãƒšãƒ¼ã‚¸åˆæœŸåŒ–');
      
      // ãƒ•ã‚©ãƒ¼ã‚«ã‚¹è¨­å®š
      document.getElementById('email').focus();
      
      // Enterã‚­ãƒ¼ã§ãƒ­ã‚°ã‚¤ãƒ³
      document.addEventListener('keypress', function(e) {
        if (e.key === 'Enter') {
          performLogin();
        }
      });
      
      // æ—¢å­˜ã‚»ãƒƒã‚·ãƒ§ãƒ³ã®ç¢ºèª
      checkExistingSession();
    };
    
    /**
     * æ—¢å­˜ã‚»ãƒƒã‚·ãƒ§ãƒ³ç¢ºèª
     */
    function checkExistingSession() {
      showStatus('ã‚»ãƒƒã‚·ãƒ§ãƒ³ç¢ºèªä¸­...', 'info');
      
      google.script.run
        .withSuccessHandler(function(result) {
          if (result && result.valid) {
            showStatus(`æ—¢å­˜ã‚»ãƒƒã‚·ãƒ§ãƒ³ã‚’æ¤œå‡º: ${result.userEmail}`, 'success');
            setTimeout(() => {
              redirectToSearch(result);
            }, 1500);
          } else {
            showStatus('æ–°è¦ãƒ­ã‚°ã‚¤ãƒ³ãŒå¿…è¦ã§ã™', 'info');
            setTimeout(() => {
              hideStatus();
            }, 2000);
          }
        })
        .withFailureHandler(function(error) {
          console.warn('ã‚»ãƒƒã‚·ãƒ§ãƒ³ç¢ºèªã‚¨ãƒ©ãƒ¼:', error);
          hideStatus();
        })
        .checkUserSession();
    }
    
    /**
     * ãƒ­ã‚°ã‚¤ãƒ³å‡¦ç†
     */
    function performLogin() {
      const email = document.getElementById('email').value.trim();
      const password = document.getElementById('password').value;
      const loginButton = document.getElementById('loginButton');
      
      // å…¥åŠ›æ¤œè¨¼
      if (!email || !password) {
        showStatus('ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ã¨ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„', 'error');
        return;
      }
      
      // ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°çŠ¶æ…‹
      setLoading(true);
      showStatus('ãƒ­ã‚°ã‚¤ãƒ³ä¸­...', 'info');
      
      console.log(`ğŸ” ãƒ­ã‚°ã‚¤ãƒ³è©¦è¡Œ: ${email}`);
      
      // GASé–¢æ•°å‘¼ã³å‡ºã—
      google.script.run
        .withSuccessHandler(function(result) {
          console.log('ãƒ­ã‚°ã‚¤ãƒ³çµæœ:', result);
          
          if (result.success) {
            showStatus(`ãƒ­ã‚°ã‚¤ãƒ³æˆåŠŸ: ${result.userData.role}ã¨ã—ã¦èªè¨¼`, 'success');
            
            // èªè¨¼æƒ…å ±ã‚’ã‚»ãƒƒã‚·ãƒ§ãƒ³ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã«ä¿å­˜
            sessionStorage.setItem('sessionId', result.sessionId);
            sessionStorage.setItem('userEmail', result.userEmail);
            sessionStorage.setItem('userData', JSON.stringify(result.userData));
            
            // 1.5ç§’å¾Œã«æ¤œç´¢ç”»é¢ã«ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆ
            setTimeout(() => {
              redirectToSearch(result);
            }, 1500);
            
          } else {
            console.error('ãƒ­ã‚°ã‚¤ãƒ³å¤±æ•—:', result.error);
            showStatus(result.error || 'ãƒ­ã‚°ã‚¤ãƒ³ã«å¤±æ•—ã—ã¾ã—ãŸ', 'error');
            setLoading(false);
            
            // ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã‚’ã‚¯ãƒªã‚¢
            document.getElementById('password').value = '';
            document.getElementById('password').focus();
          }
        })
        .withFailureHandler(function(error) {
          console.error('ãƒ­ã‚°ã‚¤ãƒ³APIå‘¼ã³å‡ºã—ã‚¨ãƒ©ãƒ¼:', error);
          showStatus('ãƒ­ã‚°ã‚¤ãƒ³å‡¦ç†ã§ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ', 'error');
          setLoading(false);
        })
        .loginUser(email, password);
    }
    
    /**
     * æ¤œç´¢ç”»é¢ã«ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆ
     */
    function redirectToSearch(authResult) {
      // GASç’°å¢ƒã§ã¯JavaScriptãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆã§ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ãŒå¤±ã‚ã‚Œã‚‹ãŸã‚
      // ã‚µãƒ¼ãƒãƒ¼ã‚µã‚¤ãƒ‰ã§ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆå‡¦ç†ã‚’è¡Œã†
      console.log('ğŸ”„ ã‚µãƒ¼ãƒãƒ¼ã‚µã‚¤ãƒ‰ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆå®Ÿè¡Œ');
      console.log('èªè¨¼çµæœ:', authResult);
      
      // GASé–¢æ•°ã‚’å‘¼ã³å‡ºã—ã¦ã‚µãƒ¼ãƒãƒ¼ã‚µã‚¤ãƒ‰ã§ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆå‡¦ç†
      google.script.run
        .withSuccessHandler(function(redirectHtml) {
          // ã‚µãƒ¼ãƒãƒ¼ã‹ã‚‰è¿”ã•ã‚ŒãŸæ¤œç´¢ç”»é¢HTMLã‚’è¡¨ç¤º
          document.open();
          document.write(redirectHtml);
          document.close();
        })
        .withFailureHandler(function(error) {
          console.error('ã‚µãƒ¼ãƒãƒ¼ã‚µã‚¤ãƒ‰ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆã‚¨ãƒ©ãƒ¼:', error);
          showStatus('ç”»é¢é·ç§»ã§ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ', 'error');
        })
        .generateSearchPageWithSession(authResult);
    }
    
    /**
     * ãƒ‡ãƒ¢ã‚¢ã‚«ã‚¦ãƒ³ãƒˆè‡ªå‹•å…¥åŠ›
     */
    function fillDemoAccount(email, password) {
      document.getElementById('email').value = email;
      document.getElementById('password').value = password;
      
      showStatus(`ãƒ‡ãƒ¢ã‚¢ã‚«ã‚¦ãƒ³ãƒˆè¨­å®š: ${email}`, 'info');
      
      // ãƒ•ã‚©ãƒ¼ã‚«ã‚¹ã‚’ãƒ­ã‚°ã‚¤ãƒ³ãƒœã‚¿ãƒ³ã«ç§»å‹•
      setTimeout(() => {
        document.getElementById('loginButton').focus();
      }, 100);
    }
    
    /**
     * ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°çŠ¶æ…‹ç®¡ç†
     */
    function setLoading(isLoading) {
      const loginButton = document.getElementById('loginButton');
      
      if (isLoading) {
        loginButton.classList.add('loading');
        loginButton.disabled = true;
      } else {
        loginButton.classList.remove('loading');
        loginButton.disabled = false;
      }
    }
    
    /**
     * ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸è¡¨ç¤º
     */
    function showStatus(message, type = 'info') {
      const statusElement = document.getElementById('statusMessage');
      
      statusElement.textContent = message;
      statusElement.className = `status-message ${type}`;
      statusElement.style.display = 'block';
      
      console.log(`ğŸ“¢ Status (${type}): ${message}`);
    }
    
    /**
     * ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸éè¡¨ç¤º
     */
    function hideStatus() {
      const statusElement = document.getElementById('statusMessage');
      statusElement.style.display = 'none';
    }
    
    /**
     * ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°
     */
    window.onerror = function(message, source, lineno, colno, error) {
      console.error('JavaScript Error:', { message, source, lineno, colno, error });
      showStatus('äºˆæœŸã—ãªã„ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ', 'error');
      setLoading(false);
    };
    
    // ãƒ‡ãƒãƒƒã‚°ç”¨ã®è¿½åŠ æƒ…å ±
    console.log('ğŸ”§ ãƒ­ã‚°ã‚¤ãƒ³ãƒšãƒ¼ã‚¸ãƒ‡ãƒãƒƒã‚°æƒ…å ±:');
    console.log('- Current URL:', window.location.href);
    console.log('- User Agent:', navigator.userAgent);
    console.log('- Session Storage Available:', typeof(Storage) !== "undefined");
  </script>
</body>
</html>